var app=app||{};!function(a){"use strict";app.init=function(a){app.options=a,app.has_inited=!1,app.dataList=new app.List([],{}),app.dataList.fetch({url:a.url,add:!0}),app.dataList.bind("reset",function(){app.has_inited||(app.has_inited=!0,app.init_components())})},app.init_components=function(){var b=app.years.slice(0),c=b[b.length-1];app.mapView=new app.MapView({el:"#map-div",$legend:a("#legend-div"),collection:app.dataList,topology:window.topology,min_max:app.min_max_rate,year:c,scale:app.options.map&&app.options.map.scale?app.options.map.scale:750}),app.tableView=new app.TableView({el:".table-view",collection:app.dataList,year:c,min_max:app.min_max_rate}),app.chartView=new app.ChartView({el:"#chart-wrap",collection:app.dataList,$popover:a(".popover"),$chart_legend:a(".chart-legend"),$zoom_toggle:a(".zoom-toggle"),chart_options:{xaxis:{min:app.years[0],max:app.years[b.length-1]}},year:c,years:app.years,maxY:app.min_max_rate.max}),app.timeline=new window.app.Timeline({el:".timeline",year:c,years:b,chunk_size:app.options.timeline&&app.options.timeline.chunk_size?app.options.timeline.chunk_size:7}),app.timeline=new window.app.Filters({el:".filter-controls",collection:app.dataList}),app.timeline.listenTo(window.Backbone,"year-change",app.set_year),app.set_year(c),app.set_year_labels(c)},app.List=window.Backbone.Collection.extend({initialize:function(a,b){this.query=b.query},parse:function(b){return app.abs=[],app.years=[],app.min_max_rate={min:100,max:0},a.each(b,function(b,c){c.rates=[],a.each(c,function(a,b){var d=/yr([0-9]*)/g,e=d.exec(a);if("ab"===a&&app.abs.push(b),e){var f=e[1];-1===app.years.indexOf(f)&&app.years.push(f),"yr"===a.replace(f,"")&&null!==b&&(c.rates.push([parseInt(f),parseFloat(b)]),b<app.min_max_rate.min&&(app.min_max_rate.min=b),b>app.min_max_rate.max&&(app.min_max_rate.max=b))}}),c.rates.sort(function(a,b){return a[0]-b[0]})}),app.years.sort(),this.sortAttribute="yr"+app.years[app.years.length-1]+"rnk",b},sortDirection:1,sortCollection:function(a){this.sortAttribute=a,this.sort()},comparator:function(a,b){return a=a.get(this.sortAttribute),b=b.get(this.sortAttribute),a===b?0:1===this.sortDirection?a>b?1:-1:b>a?1:-1}}),app.numPrecision=function(a,b){var c=Number(a),d=c.toFixed(b);return d},app.pctToColor=function(a){var b=app.options.legend_breaks,c=app.options.colors[0];if(null!==a){a=Number(app.numPrecision(a,1));for(var d=0;d<b.length;d+=1){var e=b[d],f=b[d+1];if(a>=e&&f>a||!f){c=app.options.colors[d+1];break}}}return c},app.get_year=function(){return app.selected_year},app.get_years=function(){return app.years},app.set_year_labels=function(b){a(".selected-year").html(b)},app.set_year=function(a){a&&"string"==typeof a?app.selected_year=a.replace(/^\D+/g,""):a&&(app.selected_year=a),app.set_year_labels(a)}}(jQuery),window.states_topology={type:"Topology",transform:{scale:[.006033970690119055,.0037569988037435787],translate:[-179.069176,17.896176]},objects:{states:{type:"GeometryCollection",geometries:[{type:"Polygon",arcs:[[0,1]],properties:{GEO_ID:"0400000US23",STATE:"23",NAME:"Maine",LSAD:"",CENSUSAREA:30842.923}},{type:"Polygon",arcs:[[2,3,4,5,6,7,8,9]],properties:{GEO_ID:"0400000US25",STATE:"25",NAME:"Massachusetts",LSAD:"",CENSUSAREA:7800.058}},{type:"MultiPolygon",arcs:[[[10]],[[11,12]],[[13,14,15]]],properties:{GEO_ID:"0400000US26",STATE:"26",NAME:"Michigan",LSAD:"",CENSUSAREA:56538.901}},{type:"Polygon",arcs:[[16,17,18,19,20]],properties:{GEO_ID:"0400000US30",STATE:"30",NAME:"Montana",LSAD:"",CENSUSAREA:145545.801}},{type:"Polygon",arcs:[[21,22,23,24,25]],properties:{GEO_ID:"0400000US32",STATE:"32",NAME:"Nevada",LSAD:"",CENSUSAREA:109781.18}},{type:"Polygon",arcs:[[26,27,28,29,30,31]],properties:{GEO_ID:"0400000US34",STATE:"34",NAME:"New Jersey",LSAD:"",CENSUSAREA:7354.22}},{type:"Polygon",arcs:[[32,-29,33,34,35,-10,36]],properties:{GEO_ID:"0400000US36",STATE:"36",NAME:"New York",LSAD:"",CENSUSAREA:47126.399}},{type:"Polygon",arcs:[[37,38,39,40,41]],properties:{GEO_ID:"0400000US37",STATE:"37",NAME:"North Carolina",LSAD:"",CENSUSAREA:48617.905}},{type:"Polygon",arcs:[[42,43,-14,44,45,46]],properties:{GEO_ID:"0400000US39",STATE:"39",NAME:"Ohio",LSAD:"",CENSUSAREA:40860.694}},{type:"Polygon",arcs:[[47,48,49,-46,50,-34,-28]],properties:{GEO_ID:"0400000US42",STATE:"42",NAME:"Pennsylvania",LSAD:"",CENSUSAREA:44742.703}},{type:"Polygon",arcs:[[52,53,-8]],properties:{GEO_ID:"0400000US44",STATE:"44",NAME:"Rhode Island",LSAD:"",CENSUSAREA:1033.814}},{type:"Polygon",arcs:[[-42,54,55,56,57,58,59,60,61,62]],properties:{GEO_ID:"0400000US47",STATE:"47",NAME:"Tennessee",LSAD:"",CENSUSAREA:41234.896}},{type:"Polygon",arcs:[[63,64,65,66,67]],properties:{GEO_ID:"0400000US48",STATE:"48",NAME:"Texas",LSAD:"",CENSUSAREA:261231.711}},{type:"Polygon",arcs:[[-26,68,69,70,71]],properties:{GEO_ID:"0400000US49",STATE:"49",NAME:"Utah",LSAD:"",CENSUSAREA:82169.62}},{type:"Polygon",arcs:[[72,73,74]],properties:{GEO_ID:"0400000US53",STATE:"53",NAME:"Washington",LSAD:"",CENSUSAREA:66455.521}},{type:"Polygon",arcs:[[75,76,77,-12,78,79]],properties:{GEO_ID:"0400000US55",STATE:"55",NAME:"Wisconsin",LSAD:"",CENSUSAREA:54157.805}},{type:"Polygon",arcs:[[83,84,85,86,87,-49,88,89,90]],properties:{GEO_ID:"0400000US24",STATE:"24",NAME:"Maryland",LSAD:"",CENSUSAREA:9707.241}},{type:"Polygon",arcs:[[91,92,93,-56,94]],properties:{GEO_ID:"0400000US01",STATE:"01",NAME:"Alabama",LSAD:"",CENSUSAREA:50645.326}},{type:"MultiPolygon",arcs:[[[95]],[[96]],[[97]],[[98]],[[99]],[[100]],[[101]],[[102]],[[103]],[[104]],[[105]],[[106]],[[107]],[[108]],[[109]],[[110]],[[111]]],properties:{GEO_ID:"0400000US02",STATE:"02",NAME:"Alaska",LSAD:"",CENSUSAREA:570640.95}},{type:"Polygon",arcs:[[112,113,114,-22,-72]],properties:{GEO_ID:"0400000US04",STATE:"04",NAME:"Arizona",LSAD:"",CENSUSAREA:113594.084}},{type:"Polygon",arcs:[[-58,115,116,-66,117,118]],properties:{GEO_ID:"0400000US05",STATE:"05",NAME:"Arkansas",LSAD:"",CENSUSAREA:52035.477}},{type:"Polygon",arcs:[[119,-23,-115,120]],properties:{GEO_ID:"0400000US06",STATE:"06",NAME:"California",LSAD:"",CENSUSAREA:155779.22}},{type:"Polygon",arcs:[[121,122,-71,123,124,125]],properties:{GEO_ID:"0400000US08",STATE:"08",NAME:"Colorado",LSAD:"",CENSUSAREA:103641.888}},{type:"Polygon",arcs:[[-37,-9,-54,126]],properties:{GEO_ID:"0400000US09",STATE:"09",NAME:"Connecticut",LSAD:"",CENSUSAREA:4842.355}},{type:"Polygon",arcs:[[128,-89,-48,-27]],properties:{GEO_ID:"0400000US10",STATE:"10",NAME:"Delaware",LSAD:"",CENSUSAREA:1948.543}},{type:null,properties:{GEO_ID:"0400000US11",STATE:"11",NAME:"District of Columbia",LSAD:"",CENSUSAREA:61.048}},{type:"Polygon",arcs:[[-92,130,131]],properties:{GEO_ID:"0400000US12",STATE:"12",NAME:"Florida",LSAD:"",CENSUSAREA:53624.759}},{type:"Polygon",arcs:[[-131,-95,-55,-41,132,133]],properties:{GEO_ID:"0400000US13",STATE:"13",NAME:"Georgia",LSAD:"",CENSUSAREA:57513.485}},{type:"MultiPolygon",arcs:[[[134]],[[135]],[[136]],[[137]],[[138]]],properties:{GEO_ID:"0400000US15",STATE:"15",NAME:"Hawaii",LSAD:"",CENSUSAREA:6422.628}},{type:"Polygon",arcs:[[-69,-25,139,-75,140,-18,141]],properties:{GEO_ID:"0400000US16",STATE:"16",NAME:"Idaho",LSAD:"",CENSUSAREA:82643.117}},{type:"Polygon",arcs:[[142,143,144,-80,145,146]],properties:{GEO_ID:"0400000US17",STATE:"17",NAME:"Illinois",LSAD:"",CENSUSAREA:55518.93}},{type:"Polygon",arcs:[[-147,147,-15,-44,148]],properties:{GEO_ID:"0400000US18",STATE:"18",NAME:"Indiana",LSAD:"",CENSUSAREA:35826.109}},{type:"Polygon",arcs:[[149,150,151,-76,-145,152]],properties:{GEO_ID:"0400000US19",STATE:"19",NAME:"Iowa",LSAD:"",CENSUSAREA:55857.13}},{type:"Polygon",arcs:[[153,-126,154,155]],properties:{GEO_ID:"0400000US20",STATE:"20",NAME:"Kansas",LSAD:"",CENSUSAREA:81758.717}},{type:"Polygon",arcs:[[-62,156,-143,-149,-43,157,158]],properties:{GEO_ID:"0400000US21",STATE:"21",NAME:"Kentucky",LSAD:"",CENSUSAREA:39486.338}},{type:"Polygon",arcs:[[-67,-117,160,161]],properties:{GEO_ID:"0400000US22",STATE:"22",NAME:"Louisiana",LSAD:"",CENSUSAREA:43203.905}},{type:"Polygon",arcs:[[162,163,164,-77,-152]],properties:{GEO_ID:"0400000US27",STATE:"27",NAME:"Minnesota",LSAD:"",CENSUSAREA:79626.743}},{type:"Polygon",arcs:[[165,-161,-116,-57,-94]],properties:{GEO_ID:"0400000US28",STATE:"28",NAME:"Mississippi",LSAD:"",CENSUSAREA:46923.274}},{type:"Polygon",arcs:[[-59,-119,166,-156,167,-153,-144,-157,-61,-160]],properties:{GEO_ID:"0400000US29",STATE:"29",NAME:"Missouri",LSAD:"",CENSUSAREA:68741.522}},{type:"Polygon",arcs:[[-168,-155,-125,168,169,-150]],properties:{GEO_ID:"0400000US31",STATE:"31",NAME:"Nebraska",LSAD:"",CENSUSAREA:76824.171}},{type:"Polygon",arcs:[[170,171,-1,172,-4]],properties:{GEO_ID:"0400000US33",STATE:"33",NAME:"New Hampshire",LSAD:"",CENSUSAREA:8952.651}},{type:"Polygon",arcs:[[-113,-123,173,-64,174]],properties:{GEO_ID:"0400000US35",STATE:"35",NAME:"New Mexico",LSAD:"",CENSUSAREA:121298.148}},{type:"Polygon",arcs:[[175,-20,176,-164]],properties:{GEO_ID:"0400000US38",STATE:"38",NAME:"North Dakota",LSAD:"",CENSUSAREA:69000.798}},{type:"Polygon",arcs:[[-118,-65,-174,-122,-154,-167]],properties:{GEO_ID:"0400000US40",STATE:"40",NAME:"Oklahoma",LSAD:"",CENSUSAREA:68594.921}},{type:"Polygon",arcs:[[-24,-120,177,-73,-140]],properties:{GEO_ID:"0400000US41",STATE:"41",NAME:"Oregon",LSAD:"",CENSUSAREA:95988.013}},{type:"Polygon",arcs:[[178,-133,-40]],properties:{GEO_ID:"0400000US45",STATE:"45",NAME:"South Carolina",LSAD:"",CENSUSAREA:30060.696}},{type:"Polygon",arcs:[[-170,179,-21,-176,-163,-151]],properties:{GEO_ID:"0400000US46",STATE:"46",NAME:"South Dakota",LSAD:"",CENSUSAREA:75811}},{type:"Polygon",arcs:[[-3,-36,180,-171]],properties:{GEO_ID:"0400000US50",STATE:"50",NAME:"Vermont",LSAD:"",CENSUSAREA:9216.657}},{type:"MultiPolygon",arcs:[[[182,-91]],[[183,-87,-130,-85,184,-38,-63,-159]]],properties:{GEO_ID:"0400000US51",STATE:"51",NAME:"Virginia",LSAD:"",CENSUSAREA:39490.086}},{type:"Polygon",arcs:[[-158,-47,-50,-88,-184]],properties:{GEO_ID:"0400000US54",STATE:"54",NAME:"West Virginia",LSAD:"",CENSUSAREA:24038.21}},{type:"Polygon",arcs:[[-70,-142,-17,-180,-169,-124]],properties:{GEO_ID:"0400000US56",STATE:"56",NAME:"Wyoming",LSAD:"",CENSUSAREA:97093.141}}],bbox:[-171.85254705461762,17.929988989233692,173.29661039088248,71.286886]}},arcs:[[[17959,6698],[-42,73],[-21,524]],[[17896,7295],[43,26],[94,130],[-9,47],[43,93],[9,74],[128,204],[30,-9],[24,-66],[112,44],[72,-73],[-2,-370],[63,-27],[-13,-23],[16,-88],[41,0],[29,-94],[-34,-43],[-63,-31],[-45,8],[-9,-40],[-79,4],[-76,-30],[-20,12],[-42,-110],[-111,-45],[-30,14],[-80,-130],[-28,-74]],[[17535,6614],[133,-5]],[[17668,6609],[193,-8],[79,47]],[[17940,6648],[-1,-85],[-27,-76],[36,-5],[50,-130],[88,13],[1,-37],[-116,-35],[-4,47],[-77,-58]],[[17890,6282],[-12,47]],[[17878,6329],[-5,10]],[[17873,6339],[-26,82],[-69,-3]],[[17778,6418],[-280,11]],[[17498,6429],[37,185]],[[14979,8044],[3,-28],[-64,-43],[-21,22],[82,49]],[[15161,7240],[-50,69],[18,84],[-53,67],[-113,25],[-51,32],[-171,53],[-49,61]],[[14692,7631],[94,61],[69,12],[208,164],[40,-30],[-84,-99],[90,-16],[45,-26],[40,-77],[133,-16],[74,56],[109,2],[69,20],[2,-61],[83,-29],[70,29],[3,-146],[-44,-13],[-46,32],[-8,-53],[-50,41],[-86,23],[-23,-33],[-88,-1],[-75,-93],[-32,28],[-55,-16],[-69,-150]],[[15846,6345],[-224,-10]],[[15622,6335],[0,17],[-334,0]],[[15288,6352],[34,35],[43,96],[25,124],[-8,97],[-47,142],[18,53],[-14,65],[41,76],[6,96],[27,53],[74,26],[37,-19],[4,90],[56,24],[-14,56],[58,58],[92,-41],[18,-34],[101,-40],[30,-60],[-23,-26],[30,-85],[-10,-99],[-36,-30],[-5,-46],[-41,-18],[-21,-63],[47,-43],[68,102],[57,26],[46,-58],[19,-167],[19,-66],[-19,-99],[-45,13],[-21,-81],[-34,-30],[-7,-59],[-47,-75]],[[12432,7214],[-366,-1],[-333,1],[-403,-2],[-58,3],[1,-141]],[[11273,7074],[-57,74],[-32,-50],[-39,-14],[-77,15],[-17,-32],[-102,1],[-21,86],[-54,24],[-20,70],[-68,154],[-57,-66],[-38,34],[25,71],[-14,52],[29,160],[-49,-2],[-52,74],[-131,134],[-1,73],[-54,75],[0,272]],[[10444,8279],[391,-1],[445,0],[333,1],[488,0],[332,0]],[[12433,8279],[1,-274],[0,-539]],[[12434,7466],[-2,-252]],[[10775,5085],[1,-215],[-18,-45],[-36,32],[-63,-15],[12,-54],[1,-105],[17,-94],[-10,-36]],[[10679,4553],[-316,399],[-222,265],[-148,172],[-204,228],[1,255],[0,542]],[[9790,6414],[215,0],[277,2]],[[10282,6416],[192,-1],[303,-1]],[[10777,6414],[0,-325],[-1,-339],[-1,-266],[0,-399]],[[17163,5800],[15,31]],[[17178,5831],[115,95],[-55,68],[-25,73],[25,49],[-12,31],[72,98]],[[17298,6245],[131,-96],[-20,-77]],[[17409,6072],[-39,-65],[43,-14],[-16,-173],[-52,-107],[-79,-54],[-38,13],[-70,68],[-3,38]],[[17155,5778],[-1,7]],[[17154,5785],[9,15]],[[17470,6146],[71,-22],[18,20],[88,5],[49,42],[29,-49],[-181,-91],[-121,-23],[-14,44]],[[17298,6245],[-48,32],[-22,97],[-40,42],[-410,-1],[-320,0],[0,73]],[[16458,6488],[102,75],[49,61],[-27,54],[-9,74],[96,30],[121,-10],[37,-28],[97,10],[89,67],[29,2],[18,98],[-39,54],[75,71],[111,133],[45,31],[270,7]],[[17522,7217],[-8,-105],[13,-91],[-21,-61],[15,-73],[-13,-36],[30,-29],[-3,-208]],[[17498,6429],[-11,-201],[-29,-52],[12,-30]],[[16141,4975],[229,-12],[296,0],[264,0],[174,2]],[[17104,4965],[-8,-90],[-83,-36],[8,-36],[50,14],[47,-15],[11,-65],[-71,-97],[-57,11],[-14,-73],[54,-26],[-51,-94],[-36,14],[-73,-25],[-62,-54],[-41,-63],[-19,-67],[-99,-16]],[[16660,4247],[-188,254],[-186,4],[3,30],[-43,57],[-204,14],[-139,-53]],[[15903,4553],[-201,-4]],[[15702,4549],[6,64],[44,18],[41,71],[46,0],[43,44],[41,13],[36,60],[27,-9],[64,50],[32,-9],[48,77],[11,47]],[[15989,5463],[-42,46],[-8,43],[-66,-42],[-38,28],[-24,-20],[-32,34],[-59,13],[-38,83],[-62,-3]],[[15620,5645],[3,451],[-1,239]],[[15846,6345],[86,-59],[75,-35],[78,36],[44,-8],[122,98],[81,33]],[[16332,6410],[1,-357]],[[16333,6053],[-25,-17],[11,-68],[-46,-186],[-57,-62],[-39,6],[-49,-62],[-5,-56],[-37,17],[-35,-62],[5,-54],[-23,-38],[-44,-8]],[[17178,5831],[-61,-22]],[[17117,5809],[-279,0],[-333,0]],[[16505,5809],[-172,0],[0,244]],[[16332,6410],[126,78]],[[17890,6282],[-12,47]],[[17873,6339],[-31,-13],[-19,-76],[-55,-15]],[[17768,6235],[10,25],[0,158]],[[15702,4549],[-212,-1]],[[15490,4548],[-209,2],[-221,1]],[[15060,4551],[-350,0]],[[14710,4551],[38,62],[-8,57],[78,129],[-12,20]],[[14806,4819],[23,34],[9,98]],[[14838,4951],[9,0]],[[14847,4951],[11,1]],[[14858,4952],[226,-1],[33,36],[223,5],[112,-8],[214,-7],[143,2]],[[15809,4979],[332,-4]],[[12022,3696],[-15,58],[346,0],[243,0],[0,266],[4,267],[0,332],[0,333],[6,0]],[[12606,4952],[318,0],[180,0],[0,-516],[50,-48],[72,6],[12,-51],[35,1],[82,-41],[20,25],[69,-45],[14,-37],[46,15],[81,-28],[78,14],[47,-44],[32,40],[52,0],[100,33],[60,-57],[64,-29]],[[14018,4190],[14,-22],[59,-1],[0,-142]],[[14091,4025],[0,-271],[37,-60],[45,-156],[-1,-97],[-29,-67],[7,-115],[-40,-91],[15,-29]],[[14125,3139],[-49,-11],[-76,-48],[-24,15],[7,53],[-45,-6],[12,-104],[-76,-110],[-76,-62],[-110,-24],[12,-35],[-45,-28],[-58,-79],[-49,-125],[-26,-152],[7,-146],[48,-132],[-62,-18],[-21,36],[-100,13],[-95,80],[-48,14],[-26,111],[-29,48],[-6,123],[-66,84],[-9,48],[-60,81],[-17,80],[-39,85],[-7,52],[-64,96],[-33,20],[-26,59],[-116,9],[-37,21],[-50,-36],[-27,-56],[-12,-82],[-39,-61],[-28,-1],[-40,41],[-103,66],[-60,68],[-29,76],[-1,67],[-53,135],[-64,45],[-93,136],[-41,27],[-30,71],[-24,13]],[[10777,6414],[310,1],[186,1]],[[11273,6416],[0,-267],[331,1]],[[11604,6150],[0,-300],[-2,-426],[3,-339]],[[11605,5085],[-236,-1],[-414,1],[-180,0]],[[10301,7479],[-344,1],[-23,-17],[-139,-29],[-40,-27],[-71,6],[-91,-37],[-58,32],[-46,-6],[-72,-42],[-86,29],[-8,81],[-50,60],[-72,19]],[[9201,7549],[-87,10],[30,64],[-33,56],[-56,266],[-32,38],[-13,79],[18,52],[113,-59],[145,-21],[56,6],[31,-59],[-2,-157],[33,15],[-11,123],[27,59],[-54,100],[11,92],[-49,35],[4,32],[167,-2],[290,1],[492,0]],[[10281,8279],[-1,-309],[-3,-398],[24,-93]],[[14655,6551],[-13,35],[-55,26],[-20,106],[19,31],[-27,66]],[[14559,6815],[-4,73],[-32,60],[-72,53],[-7,30],[-72,65],[-33,3],[-43,49],[8,144],[19,40],[-40,35],[30,85],[68,48],[1,147],[45,21]],[[14427,7668],[33,-4],[162,71],[-7,-53],[77,-51]],[[15161,7240],[-38,-39],[-37,-102],[19,-8],[52,80],[34,18],[28,70],[31,-21],[-69,-143],[-9,-99],[-36,-80],[5,-53],[-34,-114],[26,-126],[-7,-76]],[[15126,6547],[-164,0],[-307,4]],[[18580,158],[175,-10],[44,-30],[-32,-86],[-55,-23],[-100,20],[-72,-15],[7,66],[-19,44],[21,38],[31,-4]],[[17082,5339],[-8,0]],[[17074,5339],[8,0]],[[17136,5338],[-35,33],[-21,63],[-41,2],[-7,136],[22,45],[-19,39],[-40,-75],[1,-89],[32,-104],[-99,41],[-35,91]],[[16894,5520],[15,42]],[[16909,5562],[-13,38]],[[16896,5600],[-68,56],[-31,47]],[[16797,5703],[-13,45],[-64,54],[-48,-47],[-54,23],[-114,-106],[1,137]],[[17117,5809],[15,-335],[107,-3]],[[17239,5471],[-32,-113]],[[17207,5358],[-71,-20]],[[15590,3488],[-252,-2],[-179,1],[-6,-35],[38,-51],[-18,-105]],[[15173,3296],[-23,-8],[-42,43],[-38,-24],[-43,13]],[[15027,3320],[-13,406],[24,314],[39,484],[-17,27]],[[15490,4548],[69,-565],[49,-158],[-28,-36],[-14,-78],[17,-79],[-12,-70],[19,-74]],[[2045,9611],[28,-34],[47,28],[27,-55],[-77,-65],[-78,-22],[3,132],[50,16]],[[1799,9412],[-47,-59],[-44,39],[56,38],[14,40],[56,24],[27,-48],[-62,-34]],[[58309,9297],[-23,47],[111,-20],[-21,-35],[-67,8]],[[7079,10734],[88,16],[140,-62],[-14,-48],[40,-99],[-43,-9],[-84,52],[-50,-67],[-113,138],[36,79]],[[7368,10721],[72,-4],[-26,-44],[66,-101],[11,-68],[-123,-87],[1,128],[-30,155],[29,21]],[[7620,9990],[-58,58],[44,45],[-62,87],[-13,57],[77,-10],[26,-54],[89,-89],[-8,-70],[86,-69],[7,-125],[-58,-19],[-53,105],[-100,45],[23,39]],[[4417,10625],[12,-104],[-29,2],[-58,-75],[-119,-36],[-17,-38],[-76,-33],[-62,65],[-32,100],[14,38],[108,37],[43,64],[43,-25],[55,40],[116,-4],[2,-31]],[[7710,10304],[-45,-30],[-140,-13],[-3,50],[-4,18],[-10,28],[-47,59],[27,18],[130,-24],[92,-106]],[[7213,10544],[21,14],[59,-38],[35,-3],[39,-205],[-3,-99],[-28,-8],[-62,118],[-39,35],[17,62],[-62,86],[23,38]],[[7449,10161],[-28,75],[17,20],[-38,109],[55,25],[56,-42],[9,-47],[-39,-27],[8,-73],[-40,-40]],[[1624,12097],[97,-14],[-29,-39],[-86,2],[-43,-57],[-120,92],[-122,37],[-61,-31],[-64,47],[40,52],[117,-28],[69,33],[73,-55],[129,-39]],[[5221,11361],[-33,-113],[-32,20],[65,93]],[[2212,11252],[24,-71],[-104,-39],[-188,83],[-14,36],[80,1],[127,52],[76,-25],[-1,-37]],[[5057,11195],[-54,-7],[-91,49],[-5,-52],[-57,-24],[13,-36],[-168,-71],[-34,-51],[-84,4],[-49,-24],[-38,25],[15,45],[102,36],[-99,59],[74,115],[26,88],[-24,48],[171,84],[55,-34],[49,30],[-149,73],[-86,-67],[-52,-9],[-137,-134],[12,-30],[-64,-47],[-14,-81],[-49,-7],[-8,-52],[-82,-17],[-30,-52],[-65,-18],[-13,-79],[83,1],[60,-41],[-18,-56],[-75,-27],[-17,-61],[-57,-76],[-113,-25],[-12,-35],[-74,-21],[-31,-63],[-101,-36],[1,-62],[-37,-53],[-34,11],[-73,-69],[-29,25],[-85,-102],[-73,2],[20,-51],[-32,-47],[-84,-48],[-116,-33],[-41,8],[-100,-89],[-67,5],[-61,-45],[-75,14],[-61,-89],[-163,-35],[-91,-88],[-83,2],[-44,-41],[-82,-13],[-17,42],[40,23],[26,60],[109,40],[60,3],[108,36],[61,52],[-9,23],[124,113],[87,25],[132,-32],[-12,37],[35,74],[88,70],[83,34],[61,48],[49,-17],[4,73],[43,54],[114,92],[40,238],[62,54],[-7,42],[-169,-67],[-104,66],[-18,-37],[28,-64],[-59,-16],[-55,90],[-86,3],[-74,77],[-233,-123],[-13,120],[-34,54],[57,63],[-66,121],[-67,15],[-175,-53],[-92,9],[-12,50],[-179,148],[50,39],[-6,40],[-97,63],[-91,138],[9,49],[80,12],[-12,74],[104,107],[46,14],[-18,51],[40,83],[82,43],[68,-12],[69,-47],[45,7],[128,113],[123,-10],[65,15],[61,71],[-34,123],[-88,50],[71,19],[48,59],[-60,54],[-231,-103],[-105,29],[-70,-21],[-137,-4],[-98,-30],[-202,40],[-30,77],[-46,30],[57,77],[-186,36],[-100,44],[-5,29],[94,36],[287,137],[182,55],[158,3],[-27,-97],[25,-34],[168,8],[152,-18],[48,58],[-87,108],[66,84],[-23,23],[-100,-17],[-220,38],[-56,122],[-234,126],[-66,14],[-81,83],[27,121],[147,-5],[178,19],[119,56],[71,62],[12,94],[185,150],[110,-9],[127,52],[140,91],[164,-2],[191,43],[115,90],[295,-37],[141,-101],[156,41],[162,-21],[-27,-62],[144,-47],[131,17],[108,-18],[108,23],[295,-84],[313,-14],[139,-50],[173,45],[193,-23],[218,-93],[71,-13],[0,-305],[0,-708],[0,-989],[0,-484],[168,-32],[48,41],[101,5],[-19,-71],[83,-48],[13,-37],[169,-141],[26,-88],[103,66],[40,1],[18,80],[36,43],[129,46],[75,-62],[11,-76],[43,-8],[75,-104],[68,-35],[76,-80],[-14,-11],[201,-311],[33,-44],[-12,-47],[42,-19],[6,-54],[42,3],[82,-55],[51,-10],[59,-60],[53,-7],[-8,-93],[28,-128],[-59,-97],[-53,-42],[-43,7],[-29,107],[-76,27],[-105,78],[0,57],[-75,62],[-13,49],[62,33],[10,79],[-81,53],[-28,56],[-96,35],[11,47],[-34,95],[-81,129],[-80,13],[-52,97],[-41,-9],[23,-71],[-37,-20],[-100,94],[-27,-55],[-91,-44],[-181,108],[-103,116],[-185,86],[-57,44],[47,43],[-55,32],[-78,-34],[-107,12],[-163,70],[-165,22],[-164,-28],[-116,52],[-39,70],[-83,-28],[-67,36],[-60,65],[-61,14],[-46,50],[-173,-23],[-96,-28],[69,-92],[-54,-46],[22,-56],[-68,-22]],[[4446,10739],[-117,-69],[-78,20],[62,66],[91,13],[42,-30]],[[5172,11144],[-3,27],[144,128],[9,-25],[-66,-56],[-16,-47],[-68,-27]],[[7680,9788],[-24,10],[-61,103],[23,39],[62,-152]],[[11605,5085],[0,-298],[0,-362],[0,-387],[-1,-462]],[[11604,3576],[-335,0],[-340,171],[-280,139],[16,59]],[[10665,3945],[31,11],[2,72],[-31,16],[-3,82],[33,41],[-2,100],[20,48],[46,41],[-33,50],[-49,111],[0,36]],[[14710,4551],[10,-23],[-56,-63],[3,-64],[-44,-43],[-9,-64],[-55,-98],[22,-137],[-13,-38]],[[14568,4021],[-270,3],[-207,1]],[[14018,4190],[9,467],[-31,295]],[[13996,4952],[247,-1],[285,0],[208,0],[15,-52],[-52,-81],[107,1]],[[9091,6415],[304,3],[223,-4],[172,0]],[[10665,3945],[-399,-49],[-22,44],[-12,113],[-29,56],[-97,105],[-53,4],[-18,76],[-48,-7],[-68,38],[-57,71],[-96,16],[-55,-6],[-29,35],[2,144],[-43,34],[-18,56],[-118,196],[-31,29],[-6,48],[25,85],[-23,46],[-30,-6],[-49,64],[-19,87],[59,39],[-28,30],[11,70],[-37,17],[-3,-76],[-72,56],[-6,62],[-124,173],[-17,120],[10,49],[-14,75],[-85,114],[-7,47],[41,117],[16,150],[-25,148]],[[12766,5083],[-160,2]],[[12606,5085],[-221,-2],[-309,0],[-339,2],[-132,0]],[[11604,6150],[236,0],[234,-1],[358,1]],[[12432,6150],[332,0],[0,-266]],[[12764,5884],[1,-316],[1,-485]],[[17768,6235],[-88,-16],[-86,6],[-37,-36],[-87,-43]],[[17155,5778],[-1,7]],[[17163,5800],[-17,-24],[4,-36],[24,-39],[8,-68],[52,-76],[5,-86]],[[16909,5562],[-13,38]],[[15590,3488],[22,-77],[288,-23],[152,-15],[43,69],[84,-31]],[[16179,3411],[10,-116],[21,-131],[48,-169],[74,-183],[-7,-97],[30,-95],[58,-251],[-16,-273],[-19,-14],[-25,-124],[-113,-36],[-8,70],[-37,116],[-63,24],[-30,139],[-59,87],[-70,183],[49,105],[-23,11],[-34,-46],[-19,48],[33,188],[-6,81],[-23,70],[-57,35],[-38,60],[-2,40],[-37,58],[-64,58],[-56,-12],[-15,-34],[-69,-50],[-74,-12],[-15,64],[-79,74],[-69,39],[-56,9],[-146,-31]],[[15903,4553],[-38,-85],[79,-60],[51,-136],[42,-39],[18,-45],[46,-50],[25,-75],[45,-41],[12,-100],[48,-77],[2,-60],[39,-22]],[[16272,3763],[-41,-90],[-44,-149],[-8,-113]],[[3254,1151],[23,-28],[-25,-65],[-52,29],[4,43],[50,21]],[[3481,997],[16,19],[21,-68],[-9,-35],[-36,-6],[-23,74],[31,16]],[[3615,887],[64,-17],[-1,-31],[-72,15],[9,33]],[[3722,833],[23,-35],[24,15],[54,-41],[-9,-38],[-53,-20],[-15,54],[-39,37],[15,28]],[[3860,625],[84,-61],[29,-74],[47,-55],[-28,-48],[-87,-56],[-27,-59],[-35,32],[-1,80],[-29,104],[39,81],[8,56]],[[10282,6416],[0,487],[22,86],[-58,65],[130,321],[-75,104]],[[10281,8279],[163,0]],[[11273,7074],[1,-308],[-1,-350]],[[15088,5298],[-21,-36],[15,-49],[-68,-25],[8,-63],[-20,-22],[-80,38],[-17,-61]],[[14905,5080],[-26,3],[-38,78],[16,30],[-15,76],[-139,141],[0,44],[40,125],[-56,32],[-35,-12],[-11,87],[-107,128],[-20,81],[12,91]],[[14526,5984],[12,62],[37,15],[29,114],[-27,39],[11,45],[65,14],[51,33],[26,57],[4,84],[-38,29],[-41,75]],[[15126,6547],[-6,-51],[52,-158]],[[15172,6338],[-1,-332],[-1,-296],[-18,-48],[22,-57],[-2,-68],[-52,-108],[-25,-22],[-7,-109]],[[15172,6338],[40,-24],[76,38]],[[15620,5645],[1,-85],[-100,-59],[-62,-73],[-27,-75],[-37,1],[-28,49],[-53,-90],[-22,35],[-55,-54],[-42,40],[-107,-36]],[[13806,6039],[-28,234],[-27,22],[-6,113],[-23,20],[-29,118]],[[13693,6546],[-31,58],[20,91],[-8,47],[18,73]],[[13692,6815],[411,0],[196,0],[260,0]],[[14526,5984],[-51,63],[-254,-9],[-204,-3],[-211,4]],[[13996,5084],[-312,1],[-307,-1],[-215,1],[-396,-2]],[[12764,5884],[262,0],[255,0],[312,0],[289,-1]],[[13882,5883],[63,-56],[-29,-68],[46,-86],[36,-24],[-2,-565]],[[14858,4952],[31,18],[16,110]],[[15989,5463],[-8,-75],[58,-125],[53,-35]],[[16092,5228],[-63,-72],[-62,-39],[-26,-62],[-42,-39],[-90,-37]],[[14838,4951],[9,0]],[[14568,4021],[16,-30],[-13,-76],[39,-71],[-27,-86],[-44,-44],[-11,-75],[-18,-10],[-18,-141],[314,-2],[-20,-88],[54,-128]],[[14840,3270],[-49,-37],[37,-43],[-17,-95],[32,-37],[51,-10],[29,-58],[-24,-33],[-52,56],[-61,25],[-54,-54],[-26,45],[-38,2],[-47,-58],[-19,31],[-53,17],[10,51],[-49,25],[-17,54],[-58,25],[-56,-79],[-57,15],[-96,50],[-101,-23]],[[13692,6815],[0,479],[-67,82],[49,87]],[[13674,7463],[-6,105],[-33,89],[-10,251],[-48,150],[8,138],[-22,83]],[[13563,8279],[344,0],[0,102],[55,-24],[22,-137],[74,-33],[66,-7],[8,-30],[98,34],[79,-28],[215,-130],[98,50],[13,-37],[104,3],[72,-45],[-139,-63],[-105,-90],[-51,-64],[-102,-90],[13,-22]],[[15027,3320],[-74,11],[-113,-61]],[[13996,4952],[0,132]],[[13882,5883],[-51,84],[-25,72]],[[12432,6150],[0,532]],[[12432,6682],[403,-1],[357,0],[161,0],[91,-60],[20,26],[86,0],[83,-44],[60,-57]],[[17668,6609],[-14,22],[29,205],[56,147],[0,50],[75,49],[-8,67],[21,69]],[[17827,7218],[19,58],[50,19]],[[17959,6698],[-19,-50]],[[12606,5085],[0,-133]],[[12022,3696],[-278,0],[0,-119],[-140,-1]],[[13674,7463],[-203,0],[-244,1],[-358,1],[-435,1]],[[12433,8279],[304,0],[381,0],[445,0]],[[9091,6415],[-36,87],[7,67],[-27,70],[53,191],[11,67],[32,356],[6,137],[-6,135],[70,24]],[[16660,4247],[-65,-57],[-35,-69],[-7,-55],[-133,-148],[-57,-37],[-91,-118]],[[12432,6682],[0,532]],[[17522,7217],[305,1]],[[17082,5339],[-8,0]],[[17207,5358],[-45,-60],[-23,-94],[-40,-88],[-20,24],[17,111],[40,87]],[[16092,5228],[19,-67],[49,-21],[33,35],[23,-28],[118,66],[35,7],[0,49],[49,80],[52,117],[7,42],[56,-47],[52,116],[21,-23],[77,108],[10,79],[86,-89],[18,51]],[[16894,5520],[-32,-49],[7,-30],[45,10],[8,-43],[58,-17],[62,-69],[-21,-75],[20,-59],[-26,-60],[67,-64],[22,-99]]],bbox:[-171.85254705461762,17.929988989233692,173.29661039088248,71.286886]},function(a){"use strict";window.app.ChartView=window.Backbone.View.extend({select_color:"#222",hover_color:"#777",line_color:"#ccc",legend_template:window._.template("<%= min %> to <%= max %>"),popover_template:window._.template(a("#popover-template").html()),initialize:function(b){b&&a.extend(!0,this,b),window._.bindAll(this,"resize","plot_click","plot_hover","on_hover","off_hover","on_select","off_select"),a(window).on("resize",window._.debounce(this.resize,50)),this.dataset=this.get_data_sets(this.collection.models),this.$chart=this.$el.find("#chart-div"),this.set_legend(),this.bind(),this.render()},bind:function(){this.listenTo(window.Backbone,"map-on-hover",this.on_hover),this.listenTo(window.Backbone,"map-off-hover",this.off_hover),this.listenTo(window.Backbone,"map-on-select",this.select),this.listenTo(window.Backbone,"year-change",this.on_year_change),this.listenTo(window.Backbone,"filter",this.on_filter)},on_filter:function(a){this.filter=a,this.reset_chart()},get_data:function(){for(var a=[],b=0,c=0;c<this.dataset.length;c+=1){var d=this.dataset[c];this.filter&&this.filter.viewable_states&&-1===this.filter.viewable_states.indexOf(d.model.get("ab"))||(d.model.set("series_idx",b),b+=1,a.push(d))}return a},resize:function(){this.hide_popover()},on_hover:window._.debounce(function(a,b){this.clicked_model||(this.hover_model=a,this.highlight_series(a),b||(b=this.year,this.plot_marker()),this.show_popover(a,b))},8),off_hover:window._.debounce(function(){this.clicked_model||this.reset_chart()},8),select:function(a){this.clicked_model&&this.clicked_model===a?this.off_select(a):this.on_select(a)},on_year_change:function(a){this.year!==a&&(this.year=a,this.clicked_model&&(this.plot_marker(this.year),this.show_popover(this.clicked_model,this.year)))},on_select:function(a,b){this.clicked_model=a,this.highlight_series(a,!0),this.plot_marker(b),this.show_popover(a,b)},off_select:function(){this.clicked_model=null,this.reset_chart()},plot_marker:function(a){if(!a&&this.year&&(a=this.year),a){this.plot.unhighlight();var b=this.plot.getData(),c=this.years.indexOf(a.toString());this.plot.highlight(b[b.length-1],c)}},reset_chart:function(){this.hover_model=null,this.clicked_model=null,this.restore_chart_data(),this.plot.unhighlight(),this.hide_popover()},set_legend:function(){this.$chart_legend.empty().append(this.legend_template({min:this.chart_options.xaxis.min,max:this.chart_options.xaxis.max}))},highlight_series:function(b,c){var d=b.get("series_idx"),e=this.hover_color;c&&(e=this.select_color),this.restore_chart_data();var f=this.plot.getData(),g=f[d];a.extend(!0,g,{color:e,lines:{show:!0,lineWidth:4,shadowSize:1},points:{show:!0,fill:!1,radius:2,highlight_radius:5,hightlightColor:"#00529b"}}),f.splice(d,1),f.push(g),this.draw(f)},restore_chart_data:function(){this.draw(this.get_data())},draw:function(a){this.plot.setData(a),this.plot.draw()},plot_hover:function(a,b,c){var d=null;this.clicked_model&&c?(d=c.datapoint[0].toString(),this.plot_marker(d),this.show_popover(this.clicked_model,d),document.body.style.cursor="pointer"):this.clicked_model||(c?this.hover_model&&this.hover_model===c.series.model||(this.hover_model=c.series.model,document.body.style.cursor="pointer",d=c.datapoint[0],this.on_hover(this.hover_model,d),window.Backbone.trigger("chart-on-hover",c.series.model)):(document.body.style.cursor="default",this.hover_model&&(this.off_hover(),window.Backbone.trigger("chart-off-hover",this.hover_model),this.hover_model=null)))},plot_click:function(a,b,c){if(c&&!this.clicked_datapoint||c&&this.clicked_datapoint&&this.clicked_datapoint[0]!==c.datapoint[0]&&this.clicked_datapoint[1]!==c.datapoint[1]||c&&this.clicked_model!==c.series.model){var d=c.datapoint[0].toString(),e=c.series.model;this.clicked_model=e,this.clicked_datapoint=c.datapoint,this.on_select(c.series.model,d),window.Backbone.trigger("chart-on-select",c.series.model),window.Backbone.trigger("year-change",d)}else!c&&this.clicked_model&&(window.Backbone.trigger("chart-off-select",this.clicked_model),this.off_select())},get_tick_labels:function(){for(var a=[],b=0;b<this.years.length;b+=1){var c=this.years[b];a.push([c,"â€™"+c.substring(2,4)])}return a},render:function(){var b={xaxis:{ticks:this.get_tick_labels(),font:{size:10,family:"Helvetica",color:"#333333"}},yaxis:{min:0,max:5*Math.ceil(Math.ceil(this.maxY)/5),tickDecimals:0,tickFormatter:this.pctFormatter,font:{size:10,family:"Helvetica",color:"#333333"}},legend:{show:!1},grid:{margin:{top:5,left:40,bottom:40,right:5},axisMargin:2,borderWidth:1,borderColor:"#d3d3d3",backgroundColor:"#ffffff",hoverable:!0,clickable:!0,minBorderMargin:10,mouseActiveRadius:6}};this.chart_options&&a.extend(!0,b,this.chart_options),this.plot=a.plot(this.$chart,this.dataset,b),this.$chart.bind("plothover",this.plot_hover),this.$chart.bind("plotclick",this.plot_click)},get_data_sets:function(a){for(var b=[],c=[],d=null,e=null,f=null,g=null,h=0;h<a.length;h+=1){g=a[h],c=[],d=a[h].toJSON(),g.set("series_idx",h);for(var i=0;i<this.years.length;i+=1)e=this.years[i],f=d["yr"+e],c.push([e,f]);var j={color:"#CCC",model:g,label:g.st,data:c,lines:{show:!0,lineWidth:2,shadowSize:0},points:{highlight_radius:5,show:!0,fill:!1,radius:1.5,hightlightColor:"#00529b"},opacity:.6,shadowSize:0,hightlightColor:"#00529b"};g.set("series",j),b.push(j)}return b},pctFormatter:function(a,b){return a.toFixed(b.tickDecimals)+"%"},show_popover:function(a,b){b||(b=this.year);var c=a.toJSON(),d=c["yr"+b],e=c["yr"+b+"rnk"],f=c["yr"+b+"cnf"],g=window.app.pctToColor(d);d=null===d?"N/A":window.app.numPrecision(d,1)+"%",null===e&&(e="N/A"),f=null===f?"N/A":"+/- "+f.toFixed(1)+"%";var h=this.popover_template({state:c.st,year:b,rate:d,rank:e,color:g,conf:f});this.$popover.html(h).show()},hide_popover:function(){this.$popover.hide()}})}(jQuery),function(a){"use strict";window.app.MapView=window.Backbone.View.extend({label_options:{Florida:{x:9},California:{x:-6},Louisiana:{x:-5},Michigan:{y:16,x:9},"West Virginia":{x:-1},Vermont:{has_shortcut:!0
},"New Hampshire":{has_shortcut:!0},Massachusetts:{y:-4,has_shortcut:!0},Connecticut:{y:-3.5,has_shortcut:!0},"Rhode Island":{y:-5.5,x:-.3,has_shortcut:!0},"New Jersey":{y:4,x:.2,has_shortcut:!0},Delaware:{x:2,y:-.5,has_shortcut:!0},Maryland:{y:-6,x:-2,has_shortcut:!0},"District of Columbia":{has_shortcut:!0}},initialize:function(b){b&&a.extend(!0,this,b),window._.bindAll(this,"fill"),this.init_map(),this.render(),this.bind()},bind:function(){this.listenTo(window.Backbone,"chart-on-hover",this.on_hover),this.listenTo(window.Backbone,"chart-off-hover",this.off_hover),this.listenTo(window.Backbone,"chart-on-select",this.on_select),this.listenTo(window.Backbone,"chart-off-select",this.off_select),this.listenTo(window.Backbone,"year-change",this.on_year_change),this.listenTo(window.Backbone,"filter",this.on_filter);var a=this;this.$el.bind("mouseleave",function(){a.hover_model&&a.off_hover(a.hover_model)})},on_filter:function(a){var b=function(b,c){b.classed("inactive",function(b){return a.viewable_states&&-1===a.viewable_states.indexOf(b.properties.model.get("ab"))?!0:!1}).transition().style("opacity",function(b){return a.viewable_states&&-1===a.viewable_states.indexOf(b.properties.model.get("ab"))?c:1}).attr("transform","scale("+a.scale+")translate("+a.translate.x+","+a.translate.y+")")};this.filter=a,b(this.states,0),b(this.labels,0),a.viewable_states?this.$el.addClass("is-zoomed"):this.$el.removeClass("is-zoomed"),this.off_select()},init_map:function(){var a=window.states_topology;this.features=window.topojson.feature(a,a.objects.states).features,this.model_by_state=window.d3.nest().key(function(a){return a.get("st")}).rollup(function(a){return a[0]}).map(this.collection.models)},render_legend:function(){for(var b=window.app.options.legend_breaks,c=a('<ul class="legend-labels">'),d=0;d<b.length;d+=1){var e=b[d],f=b[d+1],g=e;g+=f?" - "+(f-.1)+"%":"%+",c.append('<li><span style="background:'+window.app.options.colors[d+1]+'"></span>'+g+"</li>")}this.$legend.html(c)},render_map:function(){var a=this,b=this.$el.find(".map-svg"),c=b.width(),d=b.height(),e=this.scale||750;this.projection=window.d3.geo.albersUsa().scale(e).translate([c/2,d/2]),this.path=window.d3.geo.path().projection(this.projection),this.map=window.d3.select(b[0]).append("svg").attr("width",c).attr("height",d);for(var f=0;f<this.features.length;f+=1){var g=this.features[f],h=this.model_by_state[g.properties.NAME];h?g.properties.model=h:console.log("no model!")}this.states=this.map.append("g").attr("id","states").selectAll("path").data(this.features),this.states.enter().append("path").attr("d",this.path).attr("class",function(a){return"state state-path state-"+a.properties.model.get("ab")}).attr("fill",a.fill),this.bind_layer(this.states),this.add_labels()},fill:function(a){var b=a.properties.model.get("yr"+this.year);return window.app.pctToColor(b)},bind_layer:function(a){var b=this;a.on("mouseover",function(a){window.d3.select(this).classed("inactive")||(b.on_mouse_over(a.properties.model),b.on_hover(a.properties.model))}).on("mouseout",function(a){window.d3.select(this).classed("inactive")||(b.on_mouse_out(a.properties.model),b.off_hover(a.properties.model))}).on("click",function(a){window.d3.select(this).classed("inactive")?window.Backbone.trigger("map-inactive-click"):b.on_click(a.properties.model)})},on_hover:function(a){if(!this.selected&&a!==this.hovering_model){this.hovering_model=a,this.off_hover(a);var b=window.d3.selectAll(".state-"+a.get("ab"));b.classed("is-hovering",!0),this.bring_to_front(a.get("ab"))}},off_hover:function(a){this.selected||(this.hovering_model=null,window.d3.selectAll(".is-hovering").classed("is-hovering",!1))},on_select:function(a){var b=window.d3.selectAll(".state-"+a.get("ab"));this.off_select(),this.selected=a,b.classed("selected",!0),this.bring_to_front(a.get("ab")),this.map.classed("has-selected",!0)},off_select:function(){this.off_hover(),this.map.classed("has-selected",!1),window.d3.selectAll(".selected").classed("selected",!1),this.selected=!1},on_click:function(a){this.selected&&this.selected===a?this.selected===a&&this.off_select():this.on_select(a),window.Backbone.trigger("map-on-select",a)},on_mouse_out:function(a){window.Backbone.trigger("map-off-hover",a)},on_mouse_over:function(a){this.selected||(window.Backbone.trigger("map-on-hover",a),this.bring_to_front(a.get("ab")))},on_year_change:function(a){var b=this;this.year!==a&&(this.year=a,this.map.selectAll(".state-path, .state-shortcut").transition().attr("fill",b.fill))},bring_to_front:function(a){this.map.selectAll(".state-path").sort(function(b,c){return b.properties.model.get("ab")!==a?-1:1})},add_labels:function(){var a=this;this.labels=this.map.append("g").attr("id","state-labels").selectAll("g").data(this.features),this.labels=this.labels.enter().append("text").attr("id",function(a){return"state-label-"+a.properties.model.get("ab")}).text(function(a){var b=a.properties.model.get("ab");return b}).attr("x",function(b){var c=b.properties.model.get("st"),d=a.path.centroid(b)[0]||0;return a.label_options[c]&&a.label_options[c].x&&(d+=a.label_options[c].x),d}).attr("y",function(b){var c=b.properties.model.get("st"),d=a.path.centroid(b)[1]+5||0;return a.label_options[c]&&a.label_options[c].y&&(d+=a.label_options[c].y),d}).attr("class","state-label"),this.bind_layer(this.labels),this.add_label_shortcuts()},add_label_shortcuts:function(){var a=this;this.label_shortcuts=this.map.append("g").attr("id","state-label-shortcuts").selectAll("g").data(this.get_label_shortcut_data()).enter().append("g").attr("class","state-shortcut-container"),this.bind_layer(this.label_shortcuts);var b=0,c=17,d=this.$el.width()-50,e=this.$el.height()-4.5*this.get_label_shortcut_data().length;this.label_shortcuts.append("rect").attr("class",function(a){return"state state-shortcut state-"+a.properties.model.get("ab")}).attr("x",d).attr("y",function(a){return b+=1,e-c*b}).attr("fill",a.fill).attr("height",12).attr("width",12),b=0,this.label_shortcuts.append("text").text(function(a){return a.properties.model.get("ab")}).attr("class","state-label").attr("x",d+24).attr("y",function(a){return b+=1,e-c*b+10})},get_label_shortcut_data:function(){if(!this.label_shortcut_data){for(var a=[],b=window._.map(this.label_options,function(a,b){return b}).reverse(),c=0;c<b.length;c+=1){var d=b[c];if(this.label_options[d].has_shortcut){var e=this.model_by_state[d];e&&a.push({properties:{model:this.model_by_state[d]}})}}this.label_shortcut_data=a}return this.label_shortcut_data},render:function(){this.render_legend(),this.render_map()}})}(jQuery),function(a){"use strict";window.app.TableView=window.Backbone.View.extend({_tableRowViews:[],tagName:"table",sortUpIcon:"icon-up",sortDnIcon:"icon-down",events:{"click th":"header_click","click td":"row_click"},initialize:function(b){b&&a.extend(!0,this,b),this.template=window._.template(a("#data-table").html()),this.$el.empty().html(this.template()),this.listenTo(this.collection,"sort",this.updateTable),this.collection.bind("reset",this.updateTable,this),this.render(),this.bind()},bind:function(){this.listenTo(window.Backbone,"year-change",this.on_year_change),this.listenTo(window.Backbone,"filter",this.on_filter)},on_filter:function(a){this.filter=a,this.updateTable()},render:function(){return this.$("th div").append(a("<span>").addClass("fa sort-icon icon-none")).find('[column="'+this.collection.sortAttribute+'"] span').removeClass("icon-none").addClass(this.sortUpIcon),this.$("th div").eq(0).find("span").removeClass("icon-none").addClass(this.sortUpIcon),this.selection_template=this.$("th div").closest("thead th").eq(0).attr("selection_template"),this.updateTable(),this},on_year_change:function(a){if(this.year!==a){this.year=a;var b=this.selection_template.replace("{{ year }}",a);this.collection.sortCollection(b)}},row_click:function(b){b.preventDefault();var c=a(b.target);c.is("tr")||(c=c.parents("tr"));var d=c.find(".state-column").attr("data-state-ab");d&&(window.location.href="/states/"+d)},header_click:function(b){var c=a(b.currentTarget),d=c.find(".sort-icon").hasClass(this.sortUpIcon);if(c.hasClass("clickable")){this.selection_template=c.attr("selection_template");var e=this.selection_template.replace("{{ year }}",this.year);c.closest("thead").find("span").removeClass(this.sortUpIcon).removeClass(this.sortDnIcon),d?(c.find(".sort-icon").removeClass("icon-none").addClass(this.sortDnIcon),this.collection.sortDirection=-1):(c.find(".sort-icon").removeClass("icon-none").addClass(this.sortUpIcon),this.collection.sortDirection=1),this.collection.sortCollection(e)}},updateTable:function(){var b=this,c=this.collection,d=this.$("tbody");d.empty(),this._tableRowViews=this.collection.map(function(a){if(!b.filter||!b.filter.viewable_states||-1!==b.filter.viewable_states.indexOf(c.get(a).get("ab"))){var e=new window.app.TableRow({model:c.get(a),year:b.year,sparkline_options:{chartRangeMin:b.min_max.min,chartRangeMax:b.min_max.max}});return d.append(e.render().$el),e}}),this.$el.addClass("table table-striped table-bordered"),a.sparkline_display_visible()}}),window.app.TableRow=window.Backbone.View.extend({tagName:"tr",className:"table-row",sparkline_options:{width:167,height:25,lineColor:"#BBB",spotColor:"#000",fillColor:"transparent",disableHighlight:!0,minSpotColor:"#000",maxSpotColor:"",spotRadius:0,lineWidth:2},initialize:function(b){b&&a.extend(!0,this,b),this.template=window._.template(a("#data-row").html())},create_spark_line:function(){var b=a("<div>&nbsp;</div>");return b.sparkline(this.model.get("rates"),this.sparkline_options),b},render:function(){var a={ak:"A",al:"B",ar:"C",az:"D",ca:"E",co:"F",ct:"G",dc:"y",de:"H",fl:"I",ga:"J",hi:"K",ia:"L",id:"M",il:"N","in":"O",ks:"P",ky:"Q",la:"R",ma:"S",md:"T",me:"U",mi:"V",mn:"W",mo:"X",ms:"Y",mt:"Z",nc:"a",nd:"b",ne:"c",nh:"d",nj:"e",nm:"f",nv:"g",ny:"h",oh:"i",ok:"j",or:"k",pa:"l",ri:"m",sc:"n",sd:"o",tn:"p",tx:"q",us:"z",ut:"r",va:"s",vt:"t",wa:"u",wi:"v",wv:"w",wy:"x"},b=this.model.toJSON(),c=window.app.numPrecision(b["yr"+this.year],1),d=b["yr"+this.year+"rnk"],e=b["yr"+this.year+"cnf"],f=b.ab.toLowerCase();return d&&(this.model.get("chart")||this.model.set("chart",this.create_spark_line()),e=null===e?"N/A":"+/- "+e.toFixed(1)+"%",this.$el.html(this.template({rank:d,color:window.app.pctToColor(b["yr"+this.year]),state:b.st,state_ab:f,stateface:a[f],rate:c,cnf:e,width:c/window.app.min_max_rate.max*100})),this.$el.find(".sparkline").append(this.model.get("chart"))),this}})}(jQuery);var app=app||{};!function(a){"use strict";window.app.Timeline=window.Backbone.View.extend({active_class:"active",node_width:40,animation_time:250,templates:{node_temple:window._.template('<a href="#" class="node"><%= year %></a>'),label:window._.template("<%= start %> to <%= end %>")},events:{"click .node":"node_click","click .next":"next_click","click .prev":"prev_click"},bind:function(){this.listenTo(window.Backbone,"year-change",this.on_year_change),this.listenTo(window.Backbone,"chart-prev-click",this.prev_click),this.listenTo(window.Backbone,"chart-next-click",this.next_click)},on_year_change:function(a){this.year!==a&&(this.year=a,this.set_active_node_by_year(a))},node_click:function(b){b.preventDefault();var c=a(b.target);this.set_active_node(c),window.Backbone.trigger("year-change",c.data("year"))},prev_click:function(a){a.preventDefault();var b=this.get_active_group_idx()-1;this.slide_to(b)},next_click:function(a){a.preventDefault();var b=this.get_active_group_idx()+1;this.slide_to(b)},slide_to:function(b){if(!this.is_animating){var c=this;this.$nodes.children().each(function(){var d=a(this),e=parseInt(d.css("left")),f=e+c.width;b>c.get_active_group_idx()&&(f=e-c.width),d.animate({left:f},c.animation_time,function(){c.is_animating=!1})}),this.is_animating=!0,this.set_active_group(b)}},set_active_group:function(a){this.active_group_idx!==a&&(this.active_group_idx=a,this.has_next(a),this.has_prev(a),window.Backbone.trigger("timeline_active_group",this.get_active_group()))},has_prev:function(a){var b="";this.years[a-1]?(b=this.get_label(this.years[a-1]),this.$prev.removeClass("disable").find(".control-label").html(b)):this.$prev.addClass("disable"),window.Backbone.trigger("timeline_has_prev",b)},has_next:function(a){var b="";this.years[a+1]?(b=this.get_label(this.years[a+1]),this.$next.removeClass("disable").find(".control-label").html(b)):this.$next.addClass("disable"),window.Backbone.trigger("timeline_has_next",b)},get_label:function(a){var b=a[0];return a.length>1&&(b+=" - "+a[a.length-1]),b},get_active_group:function(){return this.years[this.active_group_idx]},get_active_group_idx:function(){return this.active_group_idx},set_active_node:function(a){a.hasClass(this.active_class)||(this.$nodes.find(".node").removeClass("active"),a.addClass(this.active_class))},set_active_node_by_year:function(a){var b=this.node_lookup[a];b&&this.set_active_node(b)},render:function(){this.width=this.$el.find(".line-nodes").width(),this.$nodes.empty();for(var a=null,b=0;b<this.years.length;b+=1)-1!==this.years[b].indexOf(this.year)&&(a=b+1);for(b=0;b<this.years.length;b+=1){var c=this.years[b],d=this.populate_node_group(c);d.css({left:this.width*(b+1-a)}),d.children(".active").length&&this.set_active_group(b),this.$nodes.append(d)}},populate_node_group:function(b){for(var c=a('<div class="node-group"></div>'),d=this.width/(b.length+1),e=0;e<b.length;e+=1){var f=b[e],g=this.templates.node_temple({year:f}),h=a(g);h.css({left:d*(e+1)-this.node_width/2,width:this.node_width}),h.data("year",f),this.node_lookup[f]=h,f===this.year&&h.addClass(this.active_class),c.append(h)}return c},chunk_years:function(a){for(var b=[],c=0;c<a.length;c+=this.chunk_size)b.push(a.slice(c,c+this.chunk_size));return b},initialize:function(b){b&&a.extend(!0,this,b),this.years=this.chunk_years(this.years),this.$nodes=this.$el.find(".nodes"),this.$prev=this.$el.find(".prev"),this.$next=this.$el.find(".next"),this.node_lookup={},this.render(),this.bind()}})}(window.jQuery),function(a){"use strict";window.app.Filters=window.Backbone.View.extend({filters:[{name:"All States",active:!0,scale:1,translate:{x:0,y:0}},{name:"West",viewable_states:["AZ","CO","ID","MT","NV","NM","UT","WY","AK","CA","HI","OR","WA"],scale:1,translate:{x:0,y:0}},{name:"Midwest",viewable_states:["IL","IN","MI","OH","WI","IA","KS","MN","MO","NE","ND","SD"],scale:1.9,translate:{x:-180,y:-30}},{name:"South",viewable_states:["DE","FL","GA","MD","NC","SC","VA","DC","WV","AL","KY","MS","TN","AR","LA","OK","TX"],scale:1.6,translate:{x:-170,y:-133}},{name:"Northeast",viewable_states:["CT","ME","MA","NH","RI","VT","NJ","NY","PA"],scale:2.7,translate:{x:-395,y:-26}}],events:{"click .filter-btn":"filter_click"},bind:function(){this.listenTo(window.Backbone,"map-inactive-click",this.map_inactive_click)},initialize:function(){this.render(),this.bind()},map_inactive_click:function(){this.set_active(this.filters[0])},filter_click:function(b){var c=a(b.target).hasClass("filter-btn")?a(b.target):a(b.target).parents(".filter-btn"),d=c.data("filter");this.set_active(d)},set_active:function(a){a&&!a.active&&(this.reset_active(),a.active=!0,a.$filter.addClass("active"),window.Backbone.trigger("filter",a))},reset_active:function(){this.$el.find(".filter-btn").removeClass("active");for(var a=0;a<this.filters.length;a+=1){var b=this.filters[a];b.active=!1}},render:function(){for(var b=0;b<this.filters.length;b+=1){var c=this.filters[b],d=a('<div class="filter-btn"><span class="filter-btn-icon"></span>'+c.name+"</div>");c.active&&d.addClass("active"),c.$filter=d,d.data("filter",c),this.$el.append(d)}}})}(jQuery);
